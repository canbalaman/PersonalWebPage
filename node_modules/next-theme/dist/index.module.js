import e,{memo as t,useState as r,useEffect as a,useCallback as n,useContext as s,useMemo as m}from"react";import o from"next/head";const c={attribute:"class",darkTheme:"dark",defaultTheme:"light",lightTheme:"light",mediaQuery:!0,setAttribute:!0,storageKey:"theme",themes:["light","dark"]};const d=e.createContext({themes:c.themes,value:c.defaultTheme,handleChange:()=>{}}),l=t((({storageKey:t,attribute:r,mediaQuery:a,defaultTheme:n,darkTheme:s,lightTheme:m})=>{const c="class"===r?"var d=document.documentElement.classList;":"var d=document.documentElement;",d=e=>"class"===r?`d.add(${e})`:`d.setAttribute('${r}', ${e})`;return e.createElement(o,null,a?e.createElement("script",{dangerouslySetInnerHTML:{__html:`${c}!function(){try{var e=localStorage.getItem('${t}');e||(e=window.matchMedia("(prefers-color-scheme: dark)").matches?"${s}":"${m}")}catch(e){}e||(e="${n}");${d("e")}}();`}}):e.createElement("script",{dangerouslySetInnerHTML:{__html:`${c}!function(){try{var e=localStorage.getItem('${t}');}catch(e){}e||(e="${n}");${d("e")}}();`}}))})),h=({attribute:t=c.attribute,defaultTheme:s=c.defaultTheme,storageKey:m=c.storageKey,darkTheme:o=c.darkTheme,lightTheme:h=c.lightTheme,setAttribute:i=c.setAttribute,mediaQuery:u=c.mediaQuery,themes:g=[h,o],children:v})=>{const[f,T]=r();a((()=>{void 0!==f&&localStorage.setItem(m,f)}),[f,m]);const y=n((e=>{if(i){const r=document.documentElement;"class"===t?(r.classList.remove(...g),r.classList.add(e)):r.setAttribute(t,e)}}),[t,i,g]),w=n((e=>{if("system"===e&&u&&(e=window.matchMedia("(prefers-color-scheme: dark)").matches?o:h),!g.includes(e))throw new Error(`Unknown theme: ${e}. Have you included it in the themes prop?`);T(e),y(e)}),[y,o,h,u,g]),E=n((e=>{e.key===m&&w(e.newValue||s)}),[s,w,m]);a((()=>{window.addEventListener("storage",E);let e=localStorage.getItem(m);return"system"!==e&&null!==e||(e=u?window.matchMedia("(prefers-color-scheme: dark)").matches?o:h:s),T(e),()=>window.removeEventListener("storage",E)}),[]),a((()=>{f&&function(e,t,r){const a=document.documentElement;"class"===r?(a.classList.remove(...t),a.classList.add(e)):a.setAttribute(r,e)}(f,g,t)}),[f,g,t]);const $=n((e=>{w(e.matches?o:h)}),[o,w,h]);a((()=>{const e=window.matchMedia("(prefers-color-scheme: dark)");return u?e.addEventListener("change",$):e.removeEventListener("change",$),()=>e.removeEventListener("change",$)}),[u,$]);const k=e.useMemo((()=>({themes:g,handleChange:w,value:f||s})),[f,s,w,g]);return e.createElement(d.Provider,{value:k},e.createElement(l,{attribute:t,darkTheme:o,defaultTheme:s,lightTheme:h,mediaQuery:u,storageKey:m}),v)};export default()=>{const{handleChange:e,themes:t,value:r}=s(d),a=n((t=>e(t)),[e]),o=m((()=>r),[r]),c=n((()=>a(t[(t.indexOf(o)+1)%t.length])),[a,o,t]);return{theme:o,setTheme:a,toggle:c}};export{h as ThemeProvider};
